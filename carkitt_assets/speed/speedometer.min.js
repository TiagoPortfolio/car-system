function Speedometer(e){function t(e){return e>=l?l:s>=e?s:e}function a(){var e=document.createEvent("UIEvent");e.initUIEvent("speedometer:animateend",!1,!1,window,h),r.dispatchEvent(e)}var n=arguments[1]||{},r=document.getElementById(e||"speedometer");if(!r)throw"No container found!";var o=TBE.GetElementComputedStyle(r),d=Math.min(parseInt(o.width),parseInt(o.height));if(!d)throw"Cannot get container dimensions!";var s=n.min||0,l=n.max||180,h=n.value||s,c=n.threshold||50,m=n.thresholdPivot||35,u=(n.meterFromAngle||-135)-90,f=(n.meterToAngle||135)-90,g=f-u,v=n.meterTicksCount||10,p=n.meterMarksCount||3,E=(n.meterGapScale||10)/100;E>1&&(E=1);var S=void 0==n.glossy?!0:Boolean(n.glossy),y=void 0==n.display?!0:Boolean(n.display),C=void 0==n.centerRimScale?.3:Float(n.centerRimScale),w=void 0==n.center?.25:Float(n.centerScale);if(!Speedometer.themes["default"])throw"Default theme missing! Please load themes/default.js";var T=Speedometer.themes[n.theme]||Speedometer.themes["default"];for(key in Speedometer.themes["default"])void 0==T[key]&&(T[key]=Speedometer.themes["default"][key]);var B={dial:T.dial,rim:T.rim,rimArc:T.rimArc,thresh:T.thresh,center:T.center,nose:T.nose,hand:{main:T.hand,shine:T.handShine,shineTo:T.handShineTo},meter:{ticks:T.ticks,marks:T.marks,strings:T.strings,font:T.font},digits:T.digits},k={background:TBE.CreateSquareCanvasElement(d),foreground:TBE.CreateSquareCanvasElement(d),hand:TBE.CreateSquareCanvasElement(d),meter:TBE.CreateSquareCanvasElement(d),digits:TBE.CreateSquareCanvasElement(d)},M={background:TBE.GetElement2DContext(k.background),foreground:TBE.GetElement2DContext(k.foreground),hand:TBE.GetElement2DContext(k.hand),meter:TBE.GetElement2DContext(k.meter)},b=function(e){return this.x=.05*d,this.y=.05*d,this.w=d-2*this.x,this.h=d-2*this.y,this.cx=this.w/2+this.x,this.cy=this.h/2+this.y,this}.apply({});y&&(y=new DigitalDisplay({element:k.digits,placeholders:B.dial,digits:B.digits,width:d})),r.appendChild(k.background),r.appendChild(k.meter),r.appendChild(k.digits),r.appendChild(k.hand),r.appendChild(k.foreground),this.draw=function(){M.background&&M.foreground&&M.hand&&(this.drawBackground(),this.drawCenter(),this.drawGloss(),this.drawMeter(),this.drawHand(),y&&y.drawNumber(h,3,b.h/1.2,d/9))},this.update=function(e){return h=t(e),M.hand&&(TBE.ClearCanvas(k.hand),this.drawHand()),y&&(y.clear(),y.drawNumber(h,3,b.h/1.2,d/9)),h},this.rescale=function(e){l=e,M.meter&&(TBE.ClearCanvas(k.meter),this.drawMeter()),this.update(h)};var x={};this.addEventListener=function(e,t){return void 0==x[t]?(r.addEventListener(e,t,!1),x[t]=e,!0):!1},this.removeEventListener=function(e,t){return x[t]?(r.removeEventListener(e,t,!1),delete x[t],!0):!1},this.removeAllListeners=function(){for(func in x)this.removeEventListener(x[func],func)};var D=null;this.animatedUpdate=function(e,n,i){var r,o=25,d=this;if(D)throw"Animation already running!";if(e=t(e),e==h||0>=n)throw"Invalid parameters (value: "+e+", time: "+n+")";i&&this.addEventListener("speedometer:animateend",i,!1),r=(e-h)/o/(n/1e3),D=function(){var t=Math.abs(h-e)<Math.abs(r);!D||t?(d.stopAnimation(),t&&(d.update(e),a())):(d.update(h+r),setTimeout(D,1e3/o))},D.call()},this.animatedRescale=function(e,t,n){var i,r=25,o=this;if(D)throw"Animation already running!";if(e==l||s>=e||0>=t)throw"Invalid parameters (value: "+e+", time: "+t+")";n&&this.addEventListener("speedometer:animateend",n,!1),i=(e-l)/r/(t/1e3),D=function(){var t=Math.abs(l-e)<Math.abs(i);!D||t?(o.stopAnimation(),t&&(o.rescale(e),a())):(o.rescale(l+i),setTimeout(D,1e3/r))},D.call()},this.stopAnimation=function(){D=null},this.value=function(){return h},this.min=function(){return s},this.max=function(){return l},this.drawMeter=function(){function e(e,t){var a=r+m*Math.cos(e),n=o+m*Math.sin(e),i=r+(m-t.size)*Math.cos(e),d=o+(m-t.size)*Math.sin(e);h.strokeStyle=t.color,h.lineWidth=t.width,h.moveTo(a,n),h.lineTo(i,d)}function t(e,t){tx=r+(m-t.offset)*Math.cos(t.angle),ty=o+c/2+(m-t.offset)*Math.sin(t.angle),h.fillStyle=t.color,h.textAlign="center",h.font=Math.round(t.size)+"pt "+B.meter.font,h.textAlignment="center",h.fillText(e,tx,ty)}var a,n,r=b.cx,o=b.cy,h=M.meter,c=d*(E+.5)*.03,m=(d-c)/2-5*c,g=f-u,S=(l-s)/v;for(n=TBE.Deg2Rad(g/v),a=TBE.Deg2Rad(u),h.beginPath(),i=0;i<=v;i++)e(a,{size:d/20,width:d/50,color:B.meter.ticks}),t(s+Math.round(S*i),{angle:a,color:B.meter.strings,offset:d/10,size:d/23}),a+=n;for(h.stroke(),n=TBE.Deg2Rad(g/v/(p+1)),a=TBE.Deg2Rad(u),h.beginPath(),i=0;i<(p+1)*v;i++)i%(p+1)!=0&&e(a,{size:d/50,width:d/100,color:B.meter.marks}),a+=n;h.stroke()},this.drawGloss=function(){if(S){var e=M.foreground,t=.15*d,a=b.y+.07*d,n=.7*d,i=.65*d,r=e.createLinearGradient(0,0,0,a+i);if(r.addColorStop(0,"rgba(255,255,255,1.0)"),r.addColorStop(1,"rgba(255,255,255, 0.0)"),e.fillStyle=r,e.fillEllipse(t,a,n,i),y){t=.3*d,a=b.y+.7*d,n=.4*d,i=.15*d;var o=e.createLinearGradient(0,a,0,a+i);o.addColorStop(0,"rgba(255,255,255,0.0)"),o.addColorStop(.25,"rgba(255,255,255,0.0)"),o.addColorStop(1,"rgba(255,255,255,1.0)"),e.fillStyle=o,e.fillEllipse(t,a,n,i)}}},this.drawCenter=function(){var e,t=b.cx,a=b.cy,n=M.foreground;if(C>0&&C>w){e=C*(d/2);var i=t-e/2,r=a-e/2,o=e,s=e,l=n.createLinearGradient(0,r,0,r+s);l.addColorStop(0,B.center),l.addColorStop(.5,B.center),l.addColorStop(1,B.dial),n.fillStyle=l,n.fillEllipse(i,r,o,s)}if(w>0){e=w*(d/2),i=t-e/2,r=a-e/2,o=e,s=e;var h=n.createLinearGradient(i,r,o+i,r+s);h.addColorStop(0,B.nose),h.addColorStop(1,B.center),n.fillStyle=h,n.fillEllipse(i,r,o,s)}},this.drawHand=function(){var e=b.cx,t=b.cy,a=M.hand,n=d/2-.12*d,i=l-s;i=l*(h-s)/i,i=(f-u)*i/l,i+=u;var r=TBE.Deg2Rad(i),o=new Array(10);o[0]=e+n*Math.cos(r),o[1]=t+n*Math.sin(r),o[8]=e+n*Math.cos(r-.02),o[9]=t+n*Math.sin(r-.02),r=TBE.Deg2Rad(i+20),o[2]=e+.09*d*Math.cos(r),o[3]=t+.09*d*Math.sin(r),o[4]=e,o[5]=t,r=TBE.Deg2Rad(i-20),o[6]=e+.09*d*Math.cos(r),o[7]=t+.09*d*Math.sin(r),a.fillStyle=B.hand.main,a.fillPolygon(o),o=new Array(6),r=TBE.Deg2Rad(i),o[0]=e+n*Math.cos(r),o[1]=t+n*Math.sin(r),r=TBE.Deg2Rad(i+20),o[2]=e+.09*d*Math.cos(r),o[3]=t+.09*d*Math.sin(r),o[4]=e,o[5]=t;var c=a.createLinearGradient(0,0,e,t);c.addColorStop(0,B.hand.shine),c.addColorStop(1,B.hand.shineTo),a.fillStyle=c,a.fillPolygon(o)},this.drawBackground=function(){var e=b.x,t=b.y,a=b.w,n=b.h,i=M.background;i.fillStyle=B.dial,i.ellipse(e,t,a,n),i.globalAlpha=.45,i.fill(),i.strokeStyle=B.rim,i.lineWidth=.03*a,i.ellipse(e,t,a,n),i.globalAlpha=1,i.stroke(),i.strokeStyle=B.rimArc,i.lineWidth=d/40;var r=.03*d;i.strokeBoxedArc(e+r,t+r,a-2*r,n-2*r,TBE.Deg2Rad(u),TBE.Deg2Rad(g),!1),i.strokeStyle=B.thresh,i.lineWidth=d/50;var o=l-s;o=l*(m-s)/o,o=(f-u)*o/l,o+=u;var h=o-g*c/l/2;u>=h&&(h=u);var v=g*c/l;h+v>f&&(v=f-h),i.strokeBoxedArc(e+r,t+r,a-2*r,n-2*r,TBE.Deg2Rad(h),TBE.Deg2Rad(v),!1)}}Speedometer.themes={};